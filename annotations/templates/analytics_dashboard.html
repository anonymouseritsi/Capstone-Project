{% extends "base.html" %}

{% block title %}Analytics Dashboard{% endblock %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/analytics_dashboard.css' %}">
<!-- Include Plotly.js -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<div class="side-panel">
    <!-- side navigation buttons -->
    <nav class="side-panel-icons">
        <div class="home-icon">
            <span class="logo-span">
                <img src="{% static 'icons/logo.png' %}" alt="logo" id="icons">
            </span>
        </div>
        <div class="home-icon" onclick="location.href='/home';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/home.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText1">Home</p>
        </div>
        <div class="home-icon" onclick="location.href='/patients';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/patient.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText2">Patients</p>
        </div>
        <div class="home-icon" onclick="location.href='/billing';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/billing.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText3">Billing</p>
        </div>
        <div class="home-icon" onclick="location.href='/analytics-dashboard';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/analytics.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText4">Analytics</p>
        </div>
    </nav>
    <!-- logout button -->
    <div class="logout">

    </div>
</div>

<div class="analytics-container">
    <h1>Analytics Dashboard</h1>
    
    <!-- New Plotly Charts -->
    <div class="charts-grid">
        <div class="chart-card">
            <h2>Patient Distribution by Province</h2>
            <div id="newProvinceChart" class="chart-container"></div>
        </div>
    </div>
</div>

<script>
    // New Plotly Implementation
    document.addEventListener('DOMContentLoaded', function() {
        // Sample data structure (will be replaced by actual data from backend)
        const data = {
            provinces: {{ labels|safe }},
            counts: {{ counts|safe }}
        };

        // Create the province distribution chart
        const trace = {
            y: data.provinces,
            x: data.counts,
            type: 'bar',
            orientation: 'h',
            marker: {
                color: 'rgba(54, 162, 235, 0.6)'
            }
        };

        const layout = {
            title: 'Patient Distribution by Province',
            margin: { l: 150, r: 20, t: 40, b: 40 },
            yaxis: { title: 'Province' },
            xaxis: { title: 'Number of Patients' }
        };

        Plotly.newPlot('newProvinceChart', [trace], layout);
    });
</script>

{% comment %}
<!-- Original implementation for reference -->
<div class="charts-grid">
    <!-- Patient Distribution by Province -->
    <div class="chart-card">
        <h2>Patient Distribution by Province</h2>
        <div id="provinceChart" class="chart-container"></div>
    </div>
    
    <!-- Age Distribution -->
    <div class="chart-card">
        <h2>Age Distribution</h2>
        <div id="ageChart" class="chart-container"></div>
    </div>
    
    <!-- Gender Distribution -->
    <div class="chart-card">
        <h2>Gender Distribution</h2>
        <div id="genderChart" class="chart-container"></div>
    </div>
    
    <!-- Procedures Over Time -->
    <div class="chart-card">
        <h2>Procedures Over Time</h2>
        <div id="proceduresChart" class="chart-container"></div>
    </div>
</div>

<script>
    // Province Distribution Chart
    const provinceData = {{ province_data|safe }};
    Plotly.newPlot('provinceChart', [{
        type: 'bar',
        x: provinceData.provinces,
        y: provinceData.counts,
        orientation: 'h',
        marker: {
            color: 'rgba(54, 162, 235, 0.6)'
        }
    }], {
        margin: { l: 100, r: 20, t: 20, b: 40 },
        yaxis: { title: 'Province' },
        xaxis: { title: 'Number of Patients' }
    });

    // Age Distribution Chart
    const ageData = {{ age_data|safe }};
    Plotly.newPlot('ageChart', [{
        type: 'histogram',
        x: ageData,
        nbinsx: 10,
        marker: {
            color: 'rgba(255, 99, 132, 0.6)'
        }
    }], {
        margin: { l: 40, r: 20, t: 20, b: 40 },
        xaxis: { title: 'Age' },
        yaxis: { title: 'Number of Patients' }
    });

    // Gender Distribution Chart
    const genderData = {{ gender_data|safe }};
    Plotly.newPlot('genderChart', [{
        type: 'pie',
        labels: genderData.labels,
        values: genderData.values,
        hole: 0.4,
        marker: {
            colors: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)']
        }
    }], {
        margin: { l: 20, r: 20, t: 20, b: 20 }
    });

    // Procedures Over Time Chart
    const proceduresData = {{ procedures_data|safe }};
    Plotly.newPlot('proceduresChart', [{
        type: 'scatter',
        x: proceduresData.dates,
        y: proceduresData.counts,
        mode: 'lines+markers',
        line: {
            color: 'rgba(75, 192, 192, 0.6)'
        }
    }], {
        margin: { l: 40, r: 20, t: 20, b: 40 },
        xaxis: { title: 'Date' },
        yaxis: { title: 'Number of Procedures' }
    });
</script>
{% endcomment %}
{% endblock %}
