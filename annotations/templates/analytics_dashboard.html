<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            height: 100vh;
            width: 100vw;
        }

        div.side-panel {
            height: 100%;
            width: 5%;
            background-color: #E9DCC9;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            box-shadow: 0px 2px 10px rgb(0, 0, 0, 0.5);
            transition: all 0.6s ease-in-out;
            > div.logout {
                height: 10%;
                width: 100%;
                background-color: red;
            }
            > div.logo {
                height: 10%;
                width: 100%;
                /* background-color: red; */
            }
        }

        div.side-panel:hover {
            background-color: rgb(234, 227, 214);
            /* width: 12%; */
        }

        div#dark-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            z-index: 5;
            transition: background-color 0.6s ease-in-out;
        }

        nav.side-panel-icons {
            display: flex;
            flex-direction: column;
            justify-content: left;
            align-items: center;
            height: 30%;
            width: 100%;
            gap: 5%;
            /* background-color: yellow; */
        }

        div.home-icon {
            /* border: 1px solid white; */
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease-in-out;
        }

        div.home-icon:hover{
            box-shadow: 0px 1px 5px gray;
        }

        span.icon-span {
            margin-left: 2vh;
            img#icons {
                height: 5vh; width: 5vh;
            }
        }

        p#iconText1, p#iconText2, p#iconText3, p#iconText4 {
            opacity: 0;
            transition: opacity 0.3s ease-in;
            transition-delay: 0.5s;
            font-family: 'Lexend', sans-serif;
            font-weight: 200;
            font-size: 1.5rem;
            margin-left: 3vh;
            margin-right: 2vh;

        }
        header.header-section {
        height: 10vh;
        margin-left: 6%;
        padding: 1vh 2vh;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #f8f9fa;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        margin-bottom: 2vh;
    }

    header.header-section > p#headerText {
        font-weight: 600;
        font-size: 1.8rem;
        color: #2d3748;
    }    
        .chart-container {
            
        display: flex;
        justify-content: space-evenly;
        flex-direction: column;
        height: 100vh;
        margin-left: 12%;
        background-color: #718096;
    }
        
        canvas {
            width: 50% !important;
            height: 400px !important;
        }
    </style>
</head>
<body>

<div class="side-panel" onmouseover="darkenOverlay()" onmouseout="lightenOverlay()">
    <!-- side navigation buttons -->
    <nav class="side-panel-icons">
        <div class="home-icon">
            <span class="icon-span">
                <img src="logo" alt="logo" id="icons">
            </span>
        </div>
        <div class="home-icon" onclick="location.href='/home';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/home.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText1">Home</p>
        </div>
        <div class="home-icon" onclick="location.href='/patients';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/patient.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText2">Patients</p>
        </div>
        <div class="home-icon" onclick="location.href='/billing';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/billing.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText3">Billing</p>
        </div>
        <div class="home-icon" onclick="location.href='/analytics-dashboard';" style="cursor: pointer;">
            <span class="icon-span">
                <img src="{% static 'icons/analytics.png' %}" alt="home icon" id="icons">
            </span>
            <p id="iconText4">Analytics</p>
        </div>
    </nav>
    <!-- logout button -->
    <div class="logout">

    </div>
</div>
    <header class="header-section">
    <p id="headerText">
        Analytics
    </p>
    </header>

    <div class="dashboard-container">

        <!-- Doughnut Chart -->
        <div class="chart-box">
            <h2>Procedure Type Distribution</h2>
            <canvas id="procedureTypeChart" width="100" height="100"></canvas>
        </div>

        <!-- Line Chart -->
        <div class="chart-box">
            <h2>Procedures Over Time</h2>
            <canvas id="lineChart" width="100" height="100"></canvas>
        </div>

        <div class="chart-box">
            <h2>Province Distribution</h2>
            <canvas id="barChart" width="100" height="100"></canvas>
        </div>

    </div>

    <script>
        // Bar Data
        const procTypeCtx = document.getElementById('procedureTypeChart').getContext('2d');
        const procTypeChart = new Chart(procTypeCtx, {
            type: 'bar',
            data: {
                labels: {{ proc_dist_labels|safe }},
                datasets: [{
                    label: 'Procedures',
                    data: {{ proc_dist_counts|safe }},
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF'
                    ],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: true, text: 'Distribution of Procedure Types' }
                }
            }
        });

        // Line Chart Data
        const lineCtx = document.getElementById('lineChart').getContext('2d');
        const lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: {{ proc_time_labels|safe }},
                datasets: [
                    {% for ds in proc_time_datasets %}
                    {
                        label: "{{ ds.label }}",
                        data: {{ ds.data|safe }},
                        borderColor: "{{ ds.borderColor }}",
                        fill: false,
                        tension: 0.2,
                    },
                    {% endfor %}
                ]
            },
            options: {
                responsive: true,
                interaction: { mode: 'nearest', intersect: false },
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { beginAtZero: true, title: { display: true, text: 'Number of Procedures' } }
                }
            }
        });

        
    </script>

    <script>
        const ctx = document.getElementById('barChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: {{ labels|safe }},
                datasets: [{
                    label: 'Number of Patients',
                    data: {{ counts|safe }},
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y', // horizontal bar chart
                responsive: true,
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Patients'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Province'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
